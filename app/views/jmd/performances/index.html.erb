<% provide(:title, "Vorspiele für #{@contest.name}") %>

<p>
  <%= link_to "Neues Vorspiel erstellen", new_jmd_contest_performance_path(@contest), class: "btn" %>
  <%= link_to "Wettbewerbsdetails anzeigen", jmd_contest_path(@contest), class: "btn" %>
</p>

<hr />

<%= render 'filter_form', path: jmd_contest_performances_path(@contest) %>

<p>
  <%= page_entries_info @performances, model: Performance %>
  <%= info_label_tag("Filter aktiv", :warning) if filter_active? %>
</p>

<%= will_paginate @performances %>

<table class="table table-hover">
  <thead>
    <tr>
      <th>Vorspielzeit</th>
      <th width="30%">Kategorie</th>
      <th>Land</th>
      <th>Teilnehmer</th>
      <th>&nbsp;</th>
    </tr>
  </thead>
  <tbody>
    <% @performances.each do |performance| %>
    <tr>
      <td>
        <%= l performance.stage_time, format: :short if performance.stage_time %>
        <br>
        <%= if venue = performance.stage_venue
          link_to venue.name, schedule_jmd_contest_venue_path(@contest, venue)
        end %>
      </td>
      <td>
        <%= link_to performance.category.name, jmd_performance_path(performance), title: "Vorspieldetails anzeigen" %>
      </td>
      <td><%= flag_tag performance.associated_country_code %></td>
      <td>
        <% performance.appearances.role_order.each do |appearance| %>
          <% participant = appearance.participant %>
          <span class="<%= "muted" if appearance.accompaniment? %>">
            <%= link_to participant.full_name,
             jmd_contest_participant_path(@contest, participant) %>,
            <%= appearance.instrument.name %>
            <%= age_group_badge_tag(appearance) %>
          </span>
          <br />
        <% end %>
      </td>
      <td>
        <% if can? :update, Performance %>
          <%= link_to icon_tag("edit", title: "Dieses Vorspiel bearbeiten"),
                edit_jmd_performance_path(performance), class: "btn btn-mini" %>
        <% end %>
        <% if can? :destroy, Performance %>
          <%= link_to icon_tag("remove", title: "Dieses Vorspiel löschen"),
                jmd_performance_path(performance),
                method: :delete, confirm: "Soll das Vorspiel wirklich gelöscht werden?",
                class: "btn btn-mini" %>
        <% end %>
      </td>
    </tr>
    <% end %>
  </tbody>
</table>

<%= will_paginate @performances %>
